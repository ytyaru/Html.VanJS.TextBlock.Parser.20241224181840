# JaDoc

　JapaneseDocument。略して`JaDoc`。最短ファイル拡張子`jd`。

<!-- more -->

# 言語

　日本語用の簡易マークアップ言語を作りたい。

No|言語|概要
--|----|----
1|`HTML`|高性能だが複雑すぎる
2|`Markdown`|簡易だが機能不足
3|`AsciiDoc`|簡易で高機能だが英語圏ベースのため日本語圏では使いにくい（<a>等）
4|`JaDoc`|日本語圏で使いやすい簡易で高性能な言語をめざす
5|`Javel`|日本語小説の電子本を作成する簡易言語をめざす

　基本的にはMarkdownとAsciiDocを参考にして日本語用に改善する。

# ブロック要素

## 自然言語

### 本文

HTML|javel|RegExp
----|-----|------
`<h1>`〜`<h6>`|`= 文章\n\n`〜`====== 文章\n\n`|`/^(={1,}) (.+)/gm`
`<hr>`|`===`|`/^={3,}$/`
`<p>`|`段落。\n\n`|
`<br>`|`一行目\n二行目\n\n`|
`<span style="display:inline-break;">`|`自動折返ししない\\\n範囲を任意に指定する。\n\n`|`/\\$/gm`

### 引用

HTML|javel|RegExp
----|-----|------
`<blockquote>`|````\n```quote author=名前 works=作品名 season=何章何話 human=人物名 url=https://...\n引用するテキスト\n```\n````|

### 警告 Admonition

　要点、要約、警告、詳細など、多様な使われ方がある。これらはもっと明確な意味付けを持たせるべき。

HTML|javel|RegExp
----|-----|------
`<section class="">`||

`NOTE`
`TIP`
`IMPORTANT`
`CAUTION`
`WARNING`

## プログラミング言語

HTML|javel|RegExp
----|-----|------
`<pre>`|````\n```\n整形済みテキスト\n```\n````
`<pre><code>`|````html\n```\n<p>HTMLコード</p>\n```\n````

## 非言語

HTML|javel|RegExp
----|-----|------
`<table>`||
`<dd>`||

# インライン要素

HTML|javel
----|-----
`<ruby>`|`｜漢字《かんじ》`|
`<em>`|`《《強調》》`|

　編集や検索のときは欲しいが、簡易構文が必要かは微妙。

HTML|javel
----|-----
`<ins>`|`>+文章+<`|
`<del>`|`>-文章-<`|
`<mark class="search-hit">`|`>*文章*<`|
`<mark class="highlight">`|`>*文章*<`|

　AsciiDocは以下。内部ではHTMLを使用する可能性もあるが簡易構文が必要かは微妙。

HTML|javel
----|-----
`<em>`|`_語_`
`<strong>`|`*語*`
`<code>`|`` `語` ``
`<sup>`|`^語^`
`<sub>`|`~語~`
`<mark>`|`#語#`
`<span class="X">`|`[X]#語#`

## 単語

### 固有名詞

　固有名詞や顔文字などを一つの単語として囲む。これにより途中で自動折返されぬようにする。

HTML|javel
----|-----
`<span style="display:inline-break;">`|`«黄昏の森»`, `«＼(^o^)／:オワタ»`

### 縦中横

　二桁の半角英数字は縦中横としてマークしたい。

HTML|javel
----|-----
`<span style="text-combine-upright:all;">`|`AB型`, `2024年12月24日`

## 参照

* 文書内リンク
* 文書外リンク

HTML|javel
----|-----
`<a>`||

　ただし参照にはいくつかの表現方法がある。

* リンクとして表示する（下線を引く）
* ツールチップ（マウスオーバーすると短いテキストを小さくオーバーラップ表示する）
* 自作ツールチップ（マウスオーバーやキーでフォーカスすると小さいダイアログで説明エリアをオーバーラップ表示する）
* トースター（マウスオーバーやキーでクリックすると画面上部に数秒間だけ一言メッセージを表示する）
* スイッチ（マウスオーバーやキーでクリックすると本文を隠さぬよう後ろに説明エリアを挿入＆表示する。もう一度クリックすると説明エリアを隠す）
* 常駐（紙媒体の本では動的表示できないため常駐表示する。注釈として５種類の表記方法がある）

　次のような違いがある。

* 本文のみを表示したい（注釈は最大限隠したい）
* 本文が隠れぬよう注釈を表示したい（注釈に表示面積が奪われたり、煩雑な構成になる等の弊害あり）
* 本文が隠れても注釈を表示したい

　注釈をすべてリンク先に委ねると本文に集中できる。反面、わずかな説明さえもされず、気になってしまう。リンク先に遷移すれば別のタブが開き、戻るのに時間がかかってしまう。

　注釈を一言だけ入れる。要約を短く小さい字で表示する。本文が隠れぬよう表示すれば最善である。本文において理解するには一言注釈を読めば十分である。より詳しく知りたければリンク先を辿ればいい。

　Wikipediaのリンクは、フォーカスを当てると注釈がオーバーラップ表示される。そのおかげで概要を理解できるため、本文を理解するのにいちいちページ遷移せずに済む。ただし、オーバーラップ表示により本文が隠れてしまう。`ESC`キーや周辺クリックで閉じることができないため、本文が隠れて読めなくなってしまう。

　本文が隠れてしまうような注釈表示は問題である。注釈はあくまで本文の補足にすぎない。用語の意味についてその要約を示すような意味である。そのせいで本文が隠れて読めなくなってしまうのは本末転倒だ。

　まずは本文に集中させる。それからユーザ操作に応じて徐々に詳細となる注釈を展開するのが良さそう。

1. 最初はマーク（下線や※1等）で詳細があることを示す
2. フォーカス（タップ、キー）で本文が隠れぬよう割注表示する
3. さらにそれをタップすることで遷移する（外部なり本文別部位なりへ飛ぶ）

　ただし割注は常時表示するよう指定可能とする。次のような３段階で指定したい。

* 常時表示する show
* 段階展開する step
* 常時隠蔽する hide

https://jsfiddle.net/SH9fM/6/

```css
.warichu {
  display: inline-table;
  -webkit-writing-mode: vertical-lr;
  vertical-align: top;
}
.warichu-left, .warichu-right {
  font-size:50%;
  display: table-row;
}
```
```html
<div  class="v" >
    正文<span class="warichu"><span class="warichu-right">ａｂｃｄ</span><span class="warichu-left">ｅｆｇｈ</span></span>正文正文正文正文【<span class="warichu"><span class="warichu-right">ｉｊｋｌ</span><span class="warichu-left">ｍｎｏｐ</span></span>】正文正文正文正文正文
</div>
```
```javel
【割注の説明文】
```
```javel
【割注の説明文｜パイプがあればそこで強制改行する】
```
```javel
｜用語【割注の説明文】
```

　左右に割り振るのは面倒すぎるので、JSで自動的にちょうど半分になるよう、長さが最小になるよう、分割してほしい。

　分割レベルは短さをとるか、区切りの良さをとるか。

1. 最短（ちょうど半分になる所でぶった切る）
2. 文節（文節で区切る。空白領域が増えてしまう可能性が高い）

## 文書内リンク

　文書内リンクは`id`属性値を使う。指定`id`属性値のところへ飛びたいときは`href="#ここにID値を指定する"`。

```html
<a href="#h1-0">表題１へ飛ぶ</a>

<h1 id="h1-0">表題１</h1>
```

　URLのフラグメント識別子ハッシュが付与されます。

```url
https://example.com/index.html#h1-0
```

https://developer.mozilla.org/ja/docs/Web/API/URL/hash

### テキストフラグメント

* https://developer.mozilla.org/ja/docs/Web/URI/Fragment/Text_fragments

```url
https://example.com/index.html#:~:text=先頭一致するテキスト
```
```url
https://example.com#:~:text=[prefix-,]textStart[,textEnd][,-suffix]
```

## 文書外リンク

　文書外リンクに関しては、新しいタブで開くほうが戻りやすい。そこで`target="_blink"`を使う。が、セキュリティ問題があるため`rel="noopener noreferrer"`も併用すべき。

```html
target="_blank" rel="noopener noreferrer"
```
```html
<a href="https://..." target="_blank" rel="noopener noreferrer">表示テキスト</a>
```

## 注釈

　注釈はその表現方法により以下５種類がある。

No|用語|意味
--|----|----
1|割注（わりちゅう）|本文中に（）内で書く。ただしその字は本文の1/4で二行に渡る。|`割中対象（割中文）`
2|頭注（とうちゅう）|ページを二段組にして上部に書く。
3|脚注（きゃくちゅう）＝フットノート|ページを二段組にして下部に書く。
4|傍注（ぼうちゅう）＝サイドノート|ページの外側（小口寄り）に書かれた注釈。
5|後注（こうちゅう）|巻末や編、章、節などの終わりにまとめて書かれた注釈。

* https://kousei.club/%E6%A0%A1%E6%AD%A3%E3%81%99%E3%82%8B%E3%81%AA%E3%82%89%E7%9F%A5%E3%81%A3%E3%81%A6%E3%81%8A%E3%81%8D%E3%81%9F%E3%81%84%EF%BC%BB%E7%B5%8C%E9%A8%93%E3%82%92%E7%A9%8D%E3%81%BE%E3%81%AA%E3%81%8F%E3%81%A6/

  ）	1）　2）　3）
※	※1　※2　※3
注	注1　注2　注3
＊	＊　 ＊＊　 ＊＊＊
＊	＊1　＊2　＊3
（ ）	 (1)　（2）（3）
 〔 〕 	〔1〕 〔2〕〔3〕
［ ］	［1］ ［2］［3］
他にも†（ダガー）などが使用される場合があります。

```html
<sup><a href="">※1</a></sup>
```

　簡易構文としては`*1`など`/\*[1-9][0-9]{0,}/g`書式で表す。

```javel
本文*1本文
```

　あとは番号に対して補足情報を追加していく。

* URL
* コメント
* 表示方法（下線、割注、オーバーラップ、URL遷移）


# table

　表。

HTML要素|javel
--------|----^
`<table>`|
`<tr>`|
`<th>`|
`<td>`|

属性|例
----|--
`colspan`|`colspan="2"`
`rowspan`|`colspan="2"`

* `<th>`と`<td>`の区別

　`<th>`は４方向のうち、いずれか一つ指定できる。またはヘッダ無しもある。

* 上,下,左,右の各隅にヘッダをセットするか否か

````
```table type=csv th=top
列1,列2,列3
値1,値2,値3
値4,値5,値6
```
````

```
HHHHHHHH
DDDDDDDD
DDDDDDDD
...
```

````
```table type=csv th=left
列1,値1,値2
列2,値3,値4
列3,値5,値6
```
````

```
HDDDDDDD
HDDDDDDD
HDDDDDDD
...
```

　`<th>`は複数段作れる。上の段はセル結合できる。

````
```table type=csv th=top ths=2
大1, > ,大2
列1,列2,列3
値1,値2,値3
値4,値5,値6
```
````
```
  大1   大2
列1 列2 列3
...
```

````
```table type=csv th=top ths=2
大1,大2,大3
 V ,列2,列3
値1,値2,値3
値4,値5,値6
```
````
```
    大2 大3
大1 
    列2 列3
...
```

　上と左の両方にヘッダがあり、結合したい場合もありうる。

````
```table type=csv th=top:2,left:1
大1, > ,大2,大3
 V ,列2,列3,列4
左1,値1,値2,値3
左2, > , > ,   
左3,値2,値3,値4
 V , > , > ,   
左4,値5,値6,値7
```
````
```
┌───────────┐
│          大2     大3 │
│大1                   │
│      列2   列3   列4 │
│    ┌──┬──┬──┤
│横1 │値1 │値2 │値3 │
│    └──┴──┴──┤
│横2                   │
│    ┌──┬──┬──┤
│横3 │値2 │値3 │値4 │
│    └──┴──┴──┤
│                      │
│    ┌──┬──┬──┤
│横4 │値5 │値6 │値7 │
│    └──┴──┴──┤
└───────────┘
```

　セル結合は`<th>`だけ可能であり、先にくるものほど優先される。これにより`>`,`V`は省略できる。

````
```table type=csv th=top:2,left:1
大1,   ,大2,大3
   ,列2,列3,列4
左1,値1,値2,値3
左2,   ,   ,   
左3,値2,値3,値4
   ,   ,   ,   
左4,値5,値6,値7
```
````

　セルの型を指定して`align`などを決定する。

型|`align`|`prefix`|`suffix`|`unit`|要約
--|-------|--------|--------|------|----
th|`center`|
数|`right`|`￥`, `＄`|`円`, `個`|`bit`,`byte`|`3億5千万`,`4.2MiB`
字|`left`|



