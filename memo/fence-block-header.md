# Fence Block Header

　フェンスブロックヘッダは、フェンスブロックの開始位置に続けて記す追加情報である。

````javel
---fenceBlockHeader
---
````

# 形式

1. OneLiner
2. MultiLiner

## 1. OneLiner

1. Array
2. Object

### 1-1. OneLiner Array

````javel
---type one two three
---
````
```javascript
const header = ['one', 'two', 'three']
```

　配列型は値に半角スペースを含めることができない。`\ `でエスケープすることは可能。

### 1-2. OneLiner Object

````javel
---type k1=v1 k2=v2 k3=v3
---
````
```javascript
const header = {k1:'v1', k2:'v2', k3:'v3'}
```

　オブジェクト型は値に半角スペースを含めることができる。ただしキーに含めることはできない。エスケープも不可。

## 2. MultiLiner

1. Array
2. Object

### 2-1 MultiLiner Array

````javel
---type{one two three
four five six
seven eight nine ten}
---
````
```javascript
const header = ['one', 'two', 'three', ... 'ten']
```

### 2-2 MultiLiner Object

````javel
---type{k1=v1 k2=v2 k3=v3
k4=v4 k5=v5 k6=v6 k7=v7
k8=v8 k9=v9 kA=vA kB=vB}
---
````
```javascript
const header = {k1:'v1', k2:'v2', k3:'v3', ... kB:'vB'}
```

# メタ文字

　ヘッダを解析するときのメタ文字は以下である。この値をそのままヘッダのキー名や値に使用することはできない。

記号|名称
----|----
`\n`|改行コード
`=`|半角イコール
` `|半角スペース

# `type`

　ヘッダの先頭は必ず`type`を意味する文字列である。`type`の値によって、そのフェンスブロック内のテキストをどのプロセッサに渡すか決める。

```regexp
/^([_a-z][_a-zA-Z0-9]{0,})[ \{]/
```

````javel
---html
<p>本文。</p>
---
---table csv
列1,列2,列3
値1,値2,値3
値4,値5,値6
---
---javascript{name=main.js copy=true download=true
lineNo=show highlight=2:3-9,4:7-25}
列1,列2,列3
値1,値2,値3
値4,値5,値6
---
````

　`type`の末尾が` `なら単一行配列型である。`type`名との間に一つ以上のスペースがあればよい。それ以外の改行やタブなどは不可。

　`type`の末尾が`{`なら複数行オブジェクト型である。`type`名と`{`の間にスペースや改行などは一切含められず、連続しているべき。

# 配列型の値

````javel
````
```regexp
/[^ =\n]{1,}/g
```

　配列型の値は、半角スペース、半角イコール、改行以外の一字以上のテキストである。

* `\n`があるとフェンスブロック終端と見做す場合がある（複数行型の場合を除く）
* `=`があるとオブジェクト型と見做す
* ` `があると次の要素との区切りであると見做す
    * よって値に` `を含めることができない。英文などは困る
    * よってここに指定する値は単語間を`_`,`-`で区切った名詞のみとし、文章は対象外とする
    * もし半角スペースを使いたくばオブジェクト型にすること（そこでは`=`もエスケープすれば使える）

# オブジェクト型のキーと値

## キー

　ヘッダはオブジェクト形式のときキー名を指定する。キー名に使える文字は以下。

```regexp
/(([_a-z][_a-zA-Z0-9]{0,})(?!\\)=)/gm
```

* `=`の前がキー、後が値である
* キーと`=`の間にはスペースを入れることもできない
* 値の末尾と次のキー先頭との間には一つ以上のスペースがある（たとえ値の中にもスペースがあろうと最後のスペースが区切りとなる）

　JavaScriptのオブジェクトにおけるキー名になる。よってキャメルケースで命名するのが最適である。実際は以下のように様々な記号や文字も使える。

```javascript
obj['0_数字から始まる名前'] = 'value'
obj['-some-name'] = 'value'
obj['日本語'] = 'value'
```

　ただし`['']`で囲まない形式で指定する場合、以下のように最初に示した形式のみ可能である。

```javascript
obj.keyName = 'value'
obj._keyName = 'value'
```

　今回はヘッダの字句解析を簡単にするためにも、オブジェクト名指定の汎用化のためにも、先述のような書式にした。

## 値

　オブジェクト型のキーに対応する値は、次のような方法で取得する。

1. 直前に`\`がない`=`の直後を値の開始位置とする
2. 次のキー開始位置を値の終了位置とする

　1〜2の間に半角スペースを含めることが可能である。終端とキー開始位置との間には一つ以上のスペースがある。よってキー開始位置の直前にあるスペースが、値との区切り位置になる。

````javel
---type k1=v1 k2=Has space value. k3=none_space_value
---
````
````javel
---type k1=Has \= equal value. k2=v2
---
````
````javel
---type k1=Has \n newline value. k2=v2
---
````
````javel
---type k1=Has \t tab value. k2=v2
---
````

　値には以下のメタ文字をエスケープすることで使用できる。

escape|出力
------|----
`\=`|`=`
`\n`|改行コード
`\t`|タブコード

　半角スペースを持つ値は、よく`"`ダブルクォートで囲むことで表現する。その分だけ冗長になり、解析も煩雑化するため、今回は省略する。

````html
k1="Has space value." k2="noun" k3="1"
````
````javel
k1=Has space value. k2=noun k3=1
````

　値内の改行はエスケープする必要がある。それ以外での改行方法はない。エスケープせず改行できるのは値の終端からキーの開始までの間だけである。

````javel
---type{
k1=Has \n\n\n newline value.
k2=noun
k3=1
}
フェンスブロックの内容開始
...
フェンスブロックの内容終了
---
````

　つまり複数行ヘッダ内における行頭は必ずキー名になる。

