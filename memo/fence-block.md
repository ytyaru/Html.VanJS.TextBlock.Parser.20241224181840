# Fence Block

　フェンスブロックは複数行に渡って定義される。テキストブロックと対をなすものである。テキストブロックは二連続改行で一つのパラグラフとして解釈するが、フェンスブロックはまったく異なる構文解析をする。たとえば指定のプログラミング言語が書かれたものと指示し、構文ハイライトするような内容を書くのに用いる。

````javel
---
フェンス（主に以下以外の多様な何か）
---
+++
フェンス（AciiDocは非変換用だが、Javelでは再利用部品用にするか？）
+++
```
フェンス（主に`<pre><code>`）
```
===
これはhrに使う記号にしたいから無理か？
===
"""
これは`<blockquote>`要素にできそう。
"""
````

## フェンスヘッダ

　フェンスの開始にはヘッダ情報を追加することができる。

````javel
```javascript
alert('Hello JavaScript !!');
```
````

　フェンスヘッダは以下のニタイプある。

* 配列型
* KV型

````javel
```javascript main.js
alert('Hello JavaScript !!');
```
````
````javel
```javascript fileName=main.js lineNo=show highlight=1:6-10
alert('Hello JavaScript !!');
```
````

### フェンスヘッダ種別

種別|HTML
----|----
`quote`|`<blockquote>`
`table`|`<table>`
`list`|`<ul>`,`<ol>`,`<li>`
``|`<pre>`
`ascii-art`,`aa`,`^v^`|`<pre class="ascii-art">`
`monospace`,`mono`|`<pre class="monospace">`
`${lang}`|`<pre><code data-lang="${lang}">`
`samp ${lang}`|`<samp><pre><code data-lang="${lang}"></samp>`
`details ${summary}`|`<details><summary>${summary}</summary>詳細</details>`
`template`|`<template><slot></slot></template>`
`badge`|`[npm|v11.1.4][Build|Passing][[icon]name|msg]`みたいなSVG画像を生成する
`mermaid`|`<pre class="mermaid">`。グラフ（フローチャート,UML等プログラミング系の図や、マインドマップ等）
`chart`|円グラフや棒グラフなどチャート系
`todo`|ToDo
`url`,`link`,`🔗`|`<a href="${url}">${title}</a>`
`annotation`,`anno`,`⚠`|`<a href="${url}">${title}</a>`
`define`,`dictionary`|`<dl>`,`<dt>`,`<dd>`,`<dfn>`,`<abbr>`
`tab`,`menu`,`list`,`grid`|UI系。コンテナ系。
`bbs`,`thread`|掲示板形式コンテンツ。
`chat`|チャット形式コンテンツ。吹き出し。
`drama`,`scenario`|戯曲風コンテンツ。人名、セリフ、地の文、メタな説明等。
`javel-isekai-status`|WEB小説の異世界転生ものでよくあるステータス表
`javel-isekai-card`|WEB小説の異世界転生ものでよくあるギルド身分証明証やドッグタグ等
`veiwer`|Javel形式として解析し、それを表示する。（一覧型にもできる。自動ページ送りなど詳細設定も可）
`editor`|Javel形式を自由に書けるエディタを表示する。（viewerとセットにもできる）
`convertor`|Javel形式をファイル参照してHTMLに変換するUIを提示する（ボタンやDnD領域）
`part`|`任意HTML部品`

* HTML系
    * ソースコード系
        * 構文強調系（Syntax HighLight）
        * 実行（PlayGround、エディタ、ビューア、シェル、CLI）
    * データ構造系
        * 表（テーブル、フレキシブル表、表計算）
        * 木構造（ツリー、ファイルシステム、パンくずリスト、階層（抽象〜具象(C4-model)））
        * 一覧（リスト、検索、絞込、並替、ToDo）
        * グラフ系(Diagram)
        * チャート系(Chart)
    * コンテナ系
        * 要約系
            * パンくずリスト
            * メニュー
            * メガメニュー（オーバーレイ（本文の上に重ねて表示する））
            * ドロワーメニュー（ハンバーガーメニュー（☰  Ⲷ ≡ⲷ ⁝ ⵗ ⋮ ⠇ ⋯））
            * タブ
            * アコーディオン
        * 一覧系
            * ページネーション
            * カルーセル（スライダー）
        * ポップアップ系
            * ダイアログ
    * UI系
        * ボタン系（押すことで切替や実行をする）
            * スイッチ（2値(ON/OFF)の切替。テキストとON/OFF表示UIの組合せ）
            * トグル（2値以上の切替。ボタンUIとその中に任意テキストを入れる。テキストで今の状態を表す。）
            * ボタン（押下すると何らかの処理を実行する）
        * セレクト系（候補を表示する。選択しないまたは一つ以上選択した状態にできる）
            * ドロップダウン（プルダウン。）
            * リストボックス（。表示領域内に収まらねばスクロールする）
            * チェックボタン／ラジオボタン（選択できる候補を複数表示する。本文の中に直接すべてを表示する）
        * テキスト系
            * 単一行テキスト（改行コード、タブコードは入力できない）
            * 複数行テキスト（タブコードは入力できない）
            * テキストエディタ（検索、置換、構文ハイライト、サジェスト等、多機能）
        * データ系
            * 数
            * 日時
            * 色
    * 通知系
        * トースト（操作の結果などを一言だけ一時的（2〜5秒間程度）に小さく最前面で画面の上下左右中央などに目立つよう表示する）
        * プログレスバー（進捗率を数値やバーで表現する）
        * ローディング（待機中であることをアイコンで示し、画面全体をグレーアウトして操作不能にする）
        * バッジ（`[npm|v11.2.3]`のように状態を端的に表す）
    * 専用文脈系
        * AA
        * チャット
        * 掲示板
        * ステータス
        * 身分証明証
* メタ系
    * Javel
        * エディタ
        * ビューア
        * コンバータ
    * 部品
        * 再利用パーツ定義
        * 内部別ファイル参照
        * 外部別ファイル参照

　`part`は再利用可能な任意HTML部品を定義する。たとえば`table`の特定セルに含める別の`table`を定義して、入れ子のテーブルを作るなどが可能になる。

　まずはシンプルなテーブルをCSV形式で書く。

````javel
```table csv
列1,列2,列3
値1,値2,値3
値4,値5,値6
```
````

　セル2に`<ul>`リストを挿入する場合は以下。

````javel
```table csv
列1,列2,列3
値1,{part:0},値3
値4,値5,値6
```
```parts 0
* 値1-1
* 値1-2
* 値1-3
```
````

　次はフェンスでURL参照を定義する。

````javel
{url:0}に遷移する。{url:1 text:1}知恵袋。
```url tsv
0	https://www.google.co.jp/	Google
1	https://www.yahoo.co.jp/	Yahoo,ヤフー
```
````
```html
<a href="...google...">Google</a>に遷移する。
<a href="...yahoo...">ヤフー</a>知恵袋。
```

　URLは`<a>`要素で表現する。それに必要なデータをフェンス内でまとめて定義する。その形式は`tsv`。

列|意味
--|----
1|ID（文字列。メタ文字（半角スペース、カンマ、タブ、改行コード）は使えない）
2|URL
3|表示テキスト（カンマ区切りで別のテキストを作り指定できる）

```javel
{url:0 任意テキスト（フェンス内で定義した表示テキストは使わない）}
```i

アイコン|意味
--------|----
`🔗`,`§`,`¶`|アンカーリンク。内部参照。文書内のどこかに遷移する
`↗`|ハイパーリンク。外部参照。新しいタブを開いて別の文書に遷移する

　`url`,`link`だと内部か外部かを区別できない。どのキーワードにすべきか。

```javel
{url:0}
{anchor:0}
{link:0}

{anchor-link:0}
{hyper-link:0}
{a-link:0}
{h-link:0}
{a-l:0}
{h-l:0}
{al:0}
{hl:0}

{a-in:0}
{a-out:0}
{a-i:0}
{a-o:0}
{ai:0}
{ao:0}
```

　内部リンクでも新しいタブで開きたい場合があるかもしれない。そのとき、本文の表示上でその違いを視認できるようにしたい。小さいアイコン表記がほしい。また、そうしたことが可能な構文を考えねばならない。HTMLでいうと`target="_blank" rel="noopener noreferrer"`。`target="_new"`のほうが開くタブが一つで済む。実際は`_new`のところに任意テキストを使用でき、同じ名前のリンクに対しては同じタブで開く仕組み。

　こうなると`target`値もいくつか定義しておきたい。これにてタブを開きすぎることを抑える。

`target`値|意味
----------|----
`outside-reference`|外部の参考文献（著者が異なる別の文書である）
`my-reference`|自作の外部参考文献（著者が同じだが別の文書である）
`dictionary-reference`|専門用語集を参照する
`self-reference`|内部文書だが別の箇所を別タブで参照したい

　基本的には自身のタブで別ページを開かないほうがいい。間違ってタブを閉じてしまうと大本の本文が読めなくなってしまうから。

　リンクは常に別タブで開く。これを守りつつ、なるだけタブ数を抑える工夫をする。できれば[`<iframe>`][]内で表示しつつ、画面内で小さく表示できたら最善だが。セキュリティ・著作権・パフォーマンスに問題があり実現できないかも？

[`<iframe>`]:https://developer.mozilla.org/ja/docs/Web/HTML/Element/iframe

　他にも注釈として以下のような方法がある。

````javel
某{*1}
```url*
1	https://www.google.co.jp/	一言コメント
```
````
```html
某<a href="...google..." class="annotation" aria-label="一言コメント"><sup>*1</sup></a>
```

　注釈は本文内にある任意のテキスト範囲を指定したい場合がある。

````javel
任意テキスト内における{*1 ある部分}のみ注釈対象とする。
```url*
1	https://www.google.co.jp/	一言コメント
```
````
```html
任意テキスト内における<ja-annotation aid="1" label="一言コメント">ある部分</annotation>のみ注釈対象とする。
```
```html
任意テキスト内における<span class="annotation">ある部分</span><a href="...google..." class="annotation" aria-label="一言コメント"><sup>*1</sup></a>のみ注釈対象とする。
```

　よく考えたらテキストは色々ある。

* 参考文献の表題
* 参考文献の著者名
* 参考文献に対する著者のコメント

　本文テキストにどれを表示するか。

* 任意テキスト
* 参考文献の表題
* 参考文献の著者名
* 参考文献に対する著者のコメント
* 上記の組合せ

````javel
{url:0}に遷移する。
{url:0 text:en}に遷移する。
{url:0 text:ja}に遷移する。
{url:0 ゴーゴレ}に遷移する。

{url:1}知恵袋。
{url:1 text:0}知恵袋。
{url:1 text:1}知恵袋。
{url:1 アホー}知恵袋。

```url tsv
0	https://www.google.co.jp/	en:Google,ja:グーグル
1	https://www.yahoo.co.jp/	Yahoo,ヤフー
```
````
```html
<a href="...google...">Google</a>に遷移する。
<a href="...google...">Google</a>に遷移する。
<a href="...google...">グーグル</a>に遷移する。
<a href="...google...">ゴーゴレ</a>に遷移する。

<a href="...yahoo...">Yahoo</a>知恵袋。
<a href="...yahoo...">Yahoo</a>知恵袋。
<a href="...yahoo...">ヤフー</a>知恵袋。
<a href="...yahoo...">アホー</a>知恵袋。
```



　もしURLのない割注なら、もっと簡素に書ける。

````javel
(*1 割注)です。
```annotation
1	本文より小さい字で記した二段組の注釈
```
````
```html
<ja-warichuu base="割注" annotation="本文より小さい字で記した二段組の注釈"></ja-warichuu>
```
```html
<span class="warichu-base">割注</span>
<span class="warichu-start">（</span>
<span class="warichu-annotation">本文より小さい字で記した二段組の注釈</span>
<span class="warichu-end">）</span>
```

　URL参照と割注を共通書式で書きたいが、互いに必須情報が異なるため不可能。

　ただ、割注はそのまま本文内に書いたほうが読みやすく編集しやすいはず。

````javel
(割注 本文より小さい字で記した二段組の注釈)です。
````
````javel
(割注 本文より小さい字で|記した二段組の注釈)です。
````
````javel
(割注 本文より小さい字で 記した二段組の注釈)です。
````


　割注はフェンスを使わずに表記するのがベスト。

　注釈の表示方法を指定する。

* 紙面
    * 割注
    * 頭注、脚注、傍注、後注
* 画面
    * ツールチップ（本文が隠れてしまう。入力デバイスで統一した提示方法を実装せねばならない。注釈があると視認できねばならない）
    * 画面下に動的表示する（語をタップするとその注釈テキストが画面下に表示される）

　画面の場合、段階を踏んで徐々にたくさんの注釈情報を表示できる。以下のように。

1. 本文の注釈箇所に破線を引く
2. 1をタップすると画面下部に小さく注釈テキストが表示される
3. 2をタップするとダイアログで本文を隠した詳細な注釈が表示される
4. 3をタップすると新しいタブで外部文書を開く

　尚、注釈詳細はメニューが表示される部分である。`ESC`キー押下や本文タップでメニュー表示に戻る。

　尚、割注があれば、`2`を飛ばして`3`や`4`でもいい。注釈があるとき、そこをタップしたら2`,`3`,`4`のどの動作になるかをアイコンで示してくれるとベスト。

* 画面下部に注釈テキストを表示する
* ダイアログをオーバーラップして詳細な注釈を表示する
* 新しいタブを開き外部文書へ遷移する

記号|例
----|--
`）`|`1）`,`2）`,`3）`
`※`|`※1`,`※2`,`※3`
`注`|`注1`,`注2`,`注3`
`＊`|`＊`,`＊＊`,`＊＊＊`
`＊`|`＊1`,`＊2`,`＊3`
`（ ）`|`(1)`,`（2）`,`（3）`
`〔 〕`|`〔1〕 `,`〔2〕`,`〔3〕`
`［ ］`|`［1］`,`［2］`,`［3］`
　

　よく考えると`<a>`アンカー要素には、次のような役割がある。

* 指定テキストの参考文献や証拠等を参照する（新しいタブで開く。文書内ではない外部文書が対象）
* 指定テキストとその注釈を紐付ける（ツールチップ、ダイアログ、割注、脚注等で短い小さな注釈テキストを追加表示する）
* 指定テキストの詳細が書かれた本書内に遷移する（スクロール、ページ遷移などで画面に表示している内容を切り替える）


### 注釈（Annotation）

注釈|概要
----|----
割注|本文の文字サイズより小さくして2行にし括弧`（）`に入れて注釈する。補足する語に挿入する。挿入注の一種。
頭注|縦組みにおいて本文上部に表示した注釈
脚注|横組みにおいて本文下部に表示した注釈
傍注|本文ページの外側（小口寄り）に表示した注釈
後注|本文が一区切りする編、章、節などの終わりにまとめて入れる注釈


### 用語の定義（define）

　本文内に出てくる独自の専門用語を定義する。

````javel
《1》を以てなんちゃらせよ。
```define tsv
1	碧き理	青二才が考えた論理のこと
```
````
```html
<ja-term>碧き理</ja-term>を以てなんちゃらせよ。
```

　`<dfn>`要素はあるが、これは用語自体を囲み、その説明は親である`<p>`要素内に含めるものである。その場合、用語とその説明を取得するのが困難になる。よって`<dl>`,`<dt>`,`<dd>`要素でまとめたほうがいい。それをTSV形式にすると上記になる。

　`define`というより`dictionary`のほうが適切かもしれない。その場合は読み仮名もほしい。

　気になるのは本文から用語が消えてしまったこと。これは読みにくい。よって次のようにしたほうがいいかもしれない。

````javel
《碧き理》を以てなんちゃらせよ。
```define tsv
｜碧き理《あお｜ことわり｜アオハ・ロジック》	青二才が考えた論理のこと
専門用語A	専門用語Aの説明文
```
````
```html
<ja-term label="青二才が考えた論理のこと"><ruby>碧<rt>あお</rt></ruby>き<ruby>理<rt>ことわり</rt></ruby></ja-term>を以てなんちゃらせよ。
```

　問題はIDの判りづらさだ。IDは`碧き理`だが、その取得が難しく、一意であることすら一見して判らない。これはルビ表記とID表記を同時に書いたせいである。

　IDとルビを同時に書いたとき、IDはルビの親文字部分となる。

　IDとルビを個別に書くと以下。重複してしまうため冗長になる。

````javel
《碧き理》を以てなんちゃらせよ。
```define tsv
碧き理	｜碧き理《あお｜ことわり｜アオハ・ロジック》	青二才が考えた論理のこと
専門用語A	専門用語Aの説明文
```
````

　最初からIDは親文字であると想定し、ルビ文字を補足情報とすると、次のようにも書ける。

````javel
《碧き理》を以てなんちゃらせよ。
```define tsv
碧き理	あお｜ことわり｜アオハル・ロジック	青二才が考えた論理のこと
専門用語A		専門用語Aの説明文
```
````

　ルビや強調の要素は次のように書く。

```javel
{ruby:親文字 おやもじ}
{ruby:親文字 おや,も,じ}
{ruby:親文字 おや,も,じ ベース}
{ruby:親文字 おや,も,じ ベ,ー,ス}
{ruby:親|文字 おや|もじ}
```
```javel
{em:強調}
```

　ルビの表示順、表示レベル、区切り単位の指定は以下。

```javel
{ruby:親文字 おや,も,じ ベ,ー,ス under ruby-level:5 gikun-level:3 split:3,1+2}
```
```javel
{ruby:親文字 おや,も,じ ベ,ー,ス under level:5,3 split:3,1+2}
```
```javel
{ruby:親文字 おや,も,じ ベ,ー,ス u l:5,3 s:3,1+2}
```

